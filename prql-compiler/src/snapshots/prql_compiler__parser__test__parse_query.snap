---
source: prql-compiler/src/parser.rs
expression: "stmts_of_string(r#\"\nfrom employees\nfilter country == \"USA\"                        # Each line transforms the previous result.\nderive [                                      # This adds columns / variables.\n  gross_salary = salary + payroll_tax,\n  gross_cost =   gross_salary + benefits_cost # Variables can use other variables.\n]\nfilter gross_cost > 0\ngroup [title, country] (\naggregate [               # `by` are the columns to group by.\n                   average salary,            # These are aggregation calcs run on each group.\n                   sum salary,\n                   average gross_salary,\n                   sum gross_salary,\n                   average gross_cost,\n  sum_gross_cost = sum gross_cost,\n  ct             = count,\n] )\nsort sum_gross_cost\nfilter ct > 200\ntake 20\n    \"#.trim())?"
---
- Pipeline:
    Pipeline:
      exprs:
        - FuncCall:
            name:
              Ident:
                path: []
                name: from
            args:
              - Ident:
                  path: []
                  name: employees
            named_args: {}
        - FuncCall:
            name:
              Ident:
                path: []
                name: filter
            args:
              - Binary:
                  left:
                    Ident:
                      path: []
                      name: country
                  op: Eq
                  right:
                    Literal:
                      String: USA
            named_args: {}
        - FuncCall:
            name:
              Ident:
                path: []
                name: derive
            args:
              - List:
                  - Binary:
                      left:
                        Ident:
                          path: []
                          name: salary
                      op: Add
                      right:
                        Ident:
                          path: []
                          name: payroll_tax
                    alias: gross_salary
                  - Binary:
                      left:
                        Ident:
                          path: []
                          name: gross_salary
                      op: Add
                      right:
                        Ident:
                          path: []
                          name: benefits_cost
                    alias: gross_cost
            named_args: {}
        - FuncCall:
            name:
              Ident:
                path: []
                name: filter
            args:
              - Binary:
                  left:
                    Ident:
                      path: []
                      name: gross_cost
                  op: Gt
                  right:
                    Literal:
                      Integer: 0
            named_args: {}
        - FuncCall:
            name:
              Ident:
                path: []
                name: group
            args:
              - List:
                  - Ident:
                      path: []
                      name: title
                  - Ident:
                      path: []
                      name: country
              - FuncCall:
                  name:
                    Ident:
                      path: []
                      name: aggregate
                  args:
                    - List:
                        - FuncCall:
                            name:
                              Ident:
                                path: []
                                name: average
                            args:
                              - Ident:
                                  path: []
                                  name: salary
                            named_args: {}
                        - FuncCall:
                            name:
                              Ident:
                                path: []
                                name: sum
                            args:
                              - Ident:
                                  path: []
                                  name: salary
                            named_args: {}
                        - FuncCall:
                            name:
                              Ident:
                                path: []
                                name: average
                            args:
                              - Ident:
                                  path: []
                                  name: gross_salary
                            named_args: {}
                        - FuncCall:
                            name:
                              Ident:
                                path: []
                                name: sum
                            args:
                              - Ident:
                                  path: []
                                  name: gross_salary
                            named_args: {}
                        - FuncCall:
                            name:
                              Ident:
                                path: []
                                name: average
                            args:
                              - Ident:
                                  path: []
                                  name: gross_cost
                            named_args: {}
                        - FuncCall:
                            name:
                              Ident:
                                path: []
                                name: sum
                            args:
                              - Ident:
                                  path: []
                                  name: gross_cost
                            named_args: {}
                          alias: sum_gross_cost
                        - Ident:
                            path: []
                            name: count
                          alias: ct
                  named_args: {}
            named_args: {}
        - FuncCall:
            name:
              Ident:
                path: []
                name: sort
            args:
              - Ident:
                  path: []
                  name: sum_gross_cost
            named_args: {}
        - FuncCall:
            name:
              Ident:
                path: []
                name: filter
            args:
              - Binary:
                  left:
                    Ident:
                      path: []
                      name: ct
                  op: Gt
                  right:
                    Literal:
                      Integer: 200
            named_args: {}
        - FuncCall:
            name:
              Ident:
                path: []
                name: take
            args:
              - Literal:
                  Integer: 20
            named_args: {}

